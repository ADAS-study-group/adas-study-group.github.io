<!DOCTYPE html><html lang="en" mode="dark" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Linux Task Management | ADAS Study Group Tech Blog</title><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Linux Task Management" /><meta name="author" content="Jo, SeungHyeon" /><meta property="og:locale" content="en_US" /><meta name="description" content="Process, Thread and Task Managing unit Description Task Resource acquisition unit Thread Running unit Process Running or runnable program Program Executable file stored in disk Executable file is compiled to be a set of binary machine instructions and data Program and Process 1 2 3 4 5 6 7 8 9 10 $ gcc -o test test.c $ file test test: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=c1919678864f40218323926252afd86ca1cc01dc, with debug_info, not stripped $ ls test # Program test $ ps PID TTY TIME CMD 814 pts/3 00:00:00 bash 6507 pts/3 00:00:00 test # Process 6508 pts/3 00:00:00 ps Scheduling is determining processes to acquire CPU resource by the Kernel. Process structure Virtual address space structure One of the representative resource being allocated by the kernel to run process CPU Virtual memory allocation User space Kernel space 32bit 4 GB 2^(2+10+10+10) 0 ~ 3 GB 3 ~ 4 GB 64bit 16 EB (Exa = 1024^6) 0 ~ 128 TB 128 TB ~ 16 EB Segment (Virtual Memory Area Structure) Location Contents Stack region Growing down from 3GB(32bit) or 128TB(64bit) Local variables and arguments for functions Heap region Growing up from the top of Data region Dynamically allocated memory with malloc() / new() Data region Fixed region on top of Text region Global variables Text region Fixed region at the beginning of user space CPU instructions Creation and Execution of Process and Thread fork() #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; int global_cnt = 2; int main(void) { pid_t pid; int local_cnt = 3; printf(&quot;PID(%d): Parent global_cnt=%d, local_cnt=%d \n&quot;, getpid(), global_cnt, local_cnt); if (pid = fork() &lt; 0) { perror(&quot;fork error&quot;); exit(1); } else if (pid == 0) { global_cnt++ local_cnt++ } else { wait(); } printf(&quot;PID(%d): global_cnt=%d, local_cnt=%d \n&quot;, getpid(), global_cnt, local_cnt); return 0; } 1 2 3 4 5 $ gcc -o fork fork.c $ ./fork PID(10404): Parent global_cnt=2, local_cnt=3 PID(10405): global_cnt=3, local_cnt=4 PID(10404): global_cnt=2, local_cnt=3 clone() // #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sched.h&gt; int global_cnt = 2; int sub_func(void *arg) { global_cnt++; printf(&quot;PID(%d): Child global_cnt=%d \n&quot;, getpid(), global_cnt); sleep(2); return 0; } int main(void) { pid_t pid; int child_stack[4096]; int local_cnt = 3; printf(&quot;PID(%d): Parent global_cnt=%d, local_cnt=%d \n&quot;, getpid(), global_cnt, local_cnt); clone(sub_func, (void *)(child_stack+4095), CLONE_VM | CLONE_THREAD | CLONE_SIGHAND, NULL); sleep(1); printf(&quot;PID(%d): Parent global_cnt=%d, local_cnt=%d \n&quot;, getpid(), global_cnt, local_cnt); return 0; } 1 2 3 4 5 $ gcc -o clone clone.c $ ./clone PID(17351): Parent global_cnt=2, local_cnt=3 PID(17351): Child global_cnt=3 PID(17351): Parent global_cnt=3, local_cnt=3   Forked Process Cloned Thread Virtual memory address space Create another Share the same Resource cost Doubled Minimized Error propagation Parent is not affected Parent can be affected execl() #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; int main(void) { pid_t pid; int exit_status; if (pid = fork() &lt; 0) { perror(&quot;fork error&quot;); exit(1); } else if (pid == 0) { printf(&quot;Before execl() \n&quot;); execl(&quot;./fork&quot;, &quot;fork&quot;, (char *)0); printf(&quot;After execl() \n&quot;); } else { pid = wait(&amp;exit_status); } printf(&quot;Parent \n&quot;); return 0; } 1 2 3 4 5 6 7 $ gcc -o fork_exec fork_exec.c $ ./fork_exec Before execl() PID(17453): Parent global_cnt=2, local_cnt=3 PID(17454): global_cnt=3, local_cnt=4 PID(17453): global_cnt=2, local_cnt=3 Parent After execl() is not printed because “execl()” replace the process image “fork_exec” (including text, data, stack) with the previous image “fork”. In this case, “vfork()” can be used for the same address space with parent’s so that redundant memory space does not created before being replaced with the previous image “fork”. Linux task model" /><meta property="og:description" content="Process, Thread and Task Managing unit Description Task Resource acquisition unit Thread Running unit Process Running or runnable program Program Executable file stored in disk Executable file is compiled to be a set of binary machine instructions and data Program and Process 1 2 3 4 5 6 7 8 9 10 $ gcc -o test test.c $ file test test: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=c1919678864f40218323926252afd86ca1cc01dc, with debug_info, not stripped $ ls test # Program test $ ps PID TTY TIME CMD 814 pts/3 00:00:00 bash 6507 pts/3 00:00:00 test # Process 6508 pts/3 00:00:00 ps Scheduling is determining processes to acquire CPU resource by the Kernel. Process structure Virtual address space structure One of the representative resource being allocated by the kernel to run process CPU Virtual memory allocation User space Kernel space 32bit 4 GB 2^(2+10+10+10) 0 ~ 3 GB 3 ~ 4 GB 64bit 16 EB (Exa = 1024^6) 0 ~ 128 TB 128 TB ~ 16 EB Segment (Virtual Memory Area Structure) Location Contents Stack region Growing down from 3GB(32bit) or 128TB(64bit) Local variables and arguments for functions Heap region Growing up from the top of Data region Dynamically allocated memory with malloc() / new() Data region Fixed region on top of Text region Global variables Text region Fixed region at the beginning of user space CPU instructions Creation and Execution of Process and Thread fork() #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; int global_cnt = 2; int main(void) { pid_t pid; int local_cnt = 3; printf(&quot;PID(%d): Parent global_cnt=%d, local_cnt=%d \n&quot;, getpid(), global_cnt, local_cnt); if (pid = fork() &lt; 0) { perror(&quot;fork error&quot;); exit(1); } else if (pid == 0) { global_cnt++ local_cnt++ } else { wait(); } printf(&quot;PID(%d): global_cnt=%d, local_cnt=%d \n&quot;, getpid(), global_cnt, local_cnt); return 0; } 1 2 3 4 5 $ gcc -o fork fork.c $ ./fork PID(10404): Parent global_cnt=2, local_cnt=3 PID(10405): global_cnt=3, local_cnt=4 PID(10404): global_cnt=2, local_cnt=3 clone() // #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sched.h&gt; int global_cnt = 2; int sub_func(void *arg) { global_cnt++; printf(&quot;PID(%d): Child global_cnt=%d \n&quot;, getpid(), global_cnt); sleep(2); return 0; } int main(void) { pid_t pid; int child_stack[4096]; int local_cnt = 3; printf(&quot;PID(%d): Parent global_cnt=%d, local_cnt=%d \n&quot;, getpid(), global_cnt, local_cnt); clone(sub_func, (void *)(child_stack+4095), CLONE_VM | CLONE_THREAD | CLONE_SIGHAND, NULL); sleep(1); printf(&quot;PID(%d): Parent global_cnt=%d, local_cnt=%d \n&quot;, getpid(), global_cnt, local_cnt); return 0; } 1 2 3 4 5 $ gcc -o clone clone.c $ ./clone PID(17351): Parent global_cnt=2, local_cnt=3 PID(17351): Child global_cnt=3 PID(17351): Parent global_cnt=3, local_cnt=3   Forked Process Cloned Thread Virtual memory address space Create another Share the same Resource cost Doubled Minimized Error propagation Parent is not affected Parent can be affected execl() #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; int main(void) { pid_t pid; int exit_status; if (pid = fork() &lt; 0) { perror(&quot;fork error&quot;); exit(1); } else if (pid == 0) { printf(&quot;Before execl() \n&quot;); execl(&quot;./fork&quot;, &quot;fork&quot;, (char *)0); printf(&quot;After execl() \n&quot;); } else { pid = wait(&amp;exit_status); } printf(&quot;Parent \n&quot;); return 0; } 1 2 3 4 5 6 7 $ gcc -o fork_exec fork_exec.c $ ./fork_exec Before execl() PID(17453): Parent global_cnt=2, local_cnt=3 PID(17454): global_cnt=3, local_cnt=4 PID(17453): global_cnt=2, local_cnt=3 Parent After execl() is not printed because “execl()” replace the process image “fork_exec” (including text, data, stack) with the previous image “fork”. In this case, “vfork()” can be used for the same address space with parent’s so that redundant memory space does not created before being replaced with the previous image “fork”. Linux task model" /><link rel="canonical" href="https://adas-study-group.github.io/yocto_basics//posts/task-management/" /><meta property="og:url" content="https://adas-study-group.github.io/yocto_basics//posts/task-management/" /><meta property="og:site_name" content="ADAS Study Group Tech Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-07T00:00:00+09:00" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Process, Thread and Task Managing unit Description Task Resource acquisition unit Thread Running unit Process Running or runnable program Program Executable file stored in disk Executable file is compiled to be a set of binary machine instructions and data Program and Process 1 2 3 4 5 6 7 8 9 10 $ gcc -o test test.c $ file test test: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=c1919678864f40218323926252afd86ca1cc01dc, with debug_info, not stripped $ ls test # Program test $ ps PID TTY TIME CMD 814 pts/3 00:00:00 bash 6507 pts/3 00:00:00 test # Process 6508 pts/3 00:00:00 ps Scheduling is determining processes to acquire CPU resource by the Kernel. Process structure Virtual address space structure One of the representative resource being allocated by the kernel to run process CPU Virtual memory allocation User space Kernel space 32bit 4 GB 2^(2+10+10+10) 0 ~ 3 GB 3 ~ 4 GB 64bit 16 EB (Exa = 1024^6) 0 ~ 128 TB 128 TB ~ 16 EB Segment (Virtual Memory Area Structure) Location Contents Stack region Growing down from 3GB(32bit) or 128TB(64bit) Local variables and arguments for functions Heap region Growing up from the top of Data region Dynamically allocated memory with malloc() / new() Data region Fixed region on top of Text region Global variables Text region Fixed region at the beginning of user space CPU instructions Creation and Execution of Process and Thread fork() #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; int global_cnt = 2; int main(void) { pid_t pid; int local_cnt = 3; printf(&quot;PID(%d): Parent global_cnt=%d, local_cnt=%d \\n&quot;, getpid(), global_cnt, local_cnt); if (pid = fork() &lt; 0) { perror(&quot;fork error&quot;); exit(1); } else if (pid == 0) { global_cnt++ local_cnt++ } else { wait(); } printf(&quot;PID(%d): global_cnt=%d, local_cnt=%d \\n&quot;, getpid(), global_cnt, local_cnt); return 0; } 1 2 3 4 5 $ gcc -o fork fork.c $ ./fork PID(10404): Parent global_cnt=2, local_cnt=3 PID(10405): global_cnt=3, local_cnt=4 PID(10404): global_cnt=2, local_cnt=3 clone() // #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sched.h&gt; int global_cnt = 2; int sub_func(void *arg) { global_cnt++; printf(&quot;PID(%d): Child global_cnt=%d \\n&quot;, getpid(), global_cnt); sleep(2); return 0; } int main(void) { pid_t pid; int child_stack[4096]; int local_cnt = 3; printf(&quot;PID(%d): Parent global_cnt=%d, local_cnt=%d \\n&quot;, getpid(), global_cnt, local_cnt); clone(sub_func, (void *)(child_stack+4095), CLONE_VM | CLONE_THREAD | CLONE_SIGHAND, NULL); sleep(1); printf(&quot;PID(%d): Parent global_cnt=%d, local_cnt=%d \\n&quot;, getpid(), global_cnt, local_cnt); return 0; } 1 2 3 4 5 $ gcc -o clone clone.c $ ./clone PID(17351): Parent global_cnt=2, local_cnt=3 PID(17351): Child global_cnt=3 PID(17351): Parent global_cnt=3, local_cnt=3   Forked Process Cloned Thread Virtual memory address space Create another Share the same Resource cost Doubled Minimized Error propagation Parent is not affected Parent can be affected execl() #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; int main(void) { pid_t pid; int exit_status; if (pid = fork() &lt; 0) { perror(&quot;fork error&quot;); exit(1); } else if (pid == 0) { printf(&quot;Before execl() \\n&quot;); execl(&quot;./fork&quot;, &quot;fork&quot;, (char *)0); printf(&quot;After execl() \\n&quot;); } else { pid = wait(&amp;exit_status); } printf(&quot;Parent \\n&quot;); return 0; } 1 2 3 4 5 6 7 $ gcc -o fork_exec fork_exec.c $ ./fork_exec Before execl() PID(17453): Parent global_cnt=2, local_cnt=3 PID(17454): global_cnt=3, local_cnt=4 PID(17453): global_cnt=2, local_cnt=3 Parent After execl() is not printed because “execl()” replace the process image “fork_exec” (including text, data, stack) with the previous image “fork”. In this case, “vfork()” can be used for the same address space with parent’s so that redundant memory space does not created before being replaced with the previous image “fork”. Linux task model","@type":"BlogPosting","headline":"Linux Task Management","dateModified":"2020-12-07T00:00:00+09:00","datePublished":"2020-12-07T00:00:00+09:00","url":"https://adas-study-group.github.io/yocto_basics//posts/task-management/","mainEntityOfPage":{"@type":"WebPage","@id":"https://adas-study-group.github.io/yocto_basics//posts/task-management/"},"author":{"@type":"Person","name":"Jo, SeungHyeon"},"@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/about/us.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">ADAS Study Group Tech Blog</a></div><div class="site-subtitle font-italic">No Pain No Gain</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/jayleekr" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['',''].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Linux Task Management</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Linux Task Management</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Dec 7, 2020, 12:00 AM +0900" > Dec 7, 2020 <i class="unloaded">2020-12-07T00:00:00+09:00</i> </span> by <span class="author"> Jo, SeungHyeon </span></div></div><div class="post-content"><h2 id="process-thread-and-task">Process, Thread and Task</h2><div class="table-wrapper"><table><thead><tr><th>Managing unit<th>Description<tbody><tr><td>Task<td>Resource acquisition unit<tr><td>Thread<td>Running unit<tr><td>Process<td>Running or runnable program<tr><td>Program<td>Executable file stored in disk</table></div><ul><li><p>Executable file is compiled to be a set of binary machine instructions and data</p></li><li><p>Program and Process</p></li></ul><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>gcc <span class="nt">-o</span> <span class="nb">test </span>test.c
<span class="gp">$</span><span class="w"> </span>file <span class="nb">test</span>
<span class="go">test: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=c1919678864f40218323926252afd86ca1cc01dc, with debug_info, not stripped
</span><span class="gp">$</span><span class="w"> </span><span class="nb">ls test</span> <span class="c"># Program</span>
<span class="go">test
</span><span class="gp">$</span><span class="w"> </span>ps
<span class="go">  PID TTY          TIME CMD
  814 pts/3    00:00:00 bash
</span><span class="gp"> 6507 pts/3    00:00:00 test    #</span><span class="w"> </span>Process
<span class="go"> 6508 pts/3    00:00:00 ps
</span></pre></table></code></div></div><ul><li>Scheduling is determining processes to acquire CPU resource by the Kernel.</li></ul><h2 id="process-structure">Process structure</h2><ul><li>Virtual address space structure<ul><li>One of the representative resource being allocated by the kernel to run process</li></ul><div class="table-wrapper"><table><thead><tr><th>CPU<th>Virtual memory allocation<th>User space<th>Kernel space<tbody><tr><td>32bit<td>4 GB 2^(2+10+10+10)<td>0 ~ 3 GB<td>3 ~ 4 GB<tr><td>64bit<td>16 EB (Exa = 1024^6)<td>0 ~ 128 TB<td>128 TB ~ 16 EB</table></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="//assets/img/post/2020-12-07/virtual-address-space.png" alt="Virtual address space structure" /></p><div class="table-wrapper"><table><thead><tr><th>Segment (Virtual Memory Area Structure)<th>Location<th>Contents<tbody><tr><td>Stack region<td>Growing down from 3GB(32bit) or 128TB(64bit)<td>Local variables and arguments for functions<tr><td>Heap region<td>Growing up from the top of Data region<td>Dynamically allocated memory with malloc() / new()<tr><td>Data region<td>Fixed region on top of Text region<td>Global variables<tr><td>Text region<td>Fixed region at the beginning of user space<td>CPU instructions</table></div></li></ul><h2 id="creation-and-execution-of-process-and-thread">Creation and Execution of Process and Thread</h2><ul><li><p>fork()</p><pre><code class="language-Cpp">#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int global_cnt = 2;

int main(void)
{
  pid_t pid;
  int local_cnt = 3;

  printf("PID(%d): Parent global_cnt=%d, local_cnt=%d \n", getpid(), global_cnt, local_cnt);

  if (pid = fork() &lt; 0) {
    perror("fork error");
    exit(1);
  }
  else if (pid == 0) {
    global_cnt++
    local_cnt++
  }
  else {
    wait();
  }

  printf("PID(%d): global_cnt=%d, local_cnt=%d \n", getpid(), global_cnt, local_cnt);

  return 0;
}
</code></pre><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>gcc <span class="nt">-o</span> fork fork.c
<span class="gp">$</span><span class="w"> </span>./fork
<span class="go">PID(10404): Parent global_cnt=2, local_cnt=3
PID(10405): global_cnt=3, local_cnt=4
PID(10404): global_cnt=2, local_cnt=3
</span></pre></table></code></div></div></li><li><p>clone()</p><pre><code class="language-Cpp">// #include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sched.h&gt;

int global_cnt = 2;

int sub_func(void *arg)
{
  global_cnt++;
  printf("PID(%d): Child global_cnt=%d \n", getpid(), global_cnt);
  sleep(2);
  return 0;
}


int main(void)
{
  pid_t pid;
  int child_stack[4096];
  int local_cnt = 3;

  printf("PID(%d): Parent global_cnt=%d, local_cnt=%d \n", getpid(), global_cnt, local_cnt);

  clone(sub_func, (void *)(child_stack+4095), CLONE_VM | CLONE_THREAD | CLONE_SIGHAND, NULL);
  sleep(1);

  printf("PID(%d): Parent global_cnt=%d, local_cnt=%d \n", getpid(), global_cnt, local_cnt);

  return 0;
}
</code></pre><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>gcc <span class="nt">-o</span> clone clone.c
<span class="gp">$</span><span class="w"> </span>./clone
<span class="go">PID(17351): Parent global_cnt=2, local_cnt=3
PID(17351): Child global_cnt=3
PID(17351): Parent global_cnt=3, local_cnt=3
</span></pre></table></code></div></div><div class="table-wrapper"><table><thead><tr><th> <th>Forked Process<th>Cloned Thread<tbody><tr><td>Virtual memory address space<td>Create another<td>Share the same<tr><td>Resource cost<td>Doubled<td>Minimized<tr><td>Error propagation<td>Parent is not affected<td>Parent can be affected</table></div></li><li><p>execl()</p></li></ul><pre><code class="language-Cpp">#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main(void)
{
  pid_t pid;
  int exit_status;

  if (pid = fork() &lt; 0) {
    perror("fork error");
    exit(1);
  }
  else if (pid == 0) {
    printf("Before execl() \n");
    execl("./fork", "fork", (char *)0);
    printf("After execl() \n");
  }
  else {
    pid = wait(&amp;exit_status);
  }

  printf("Parent \n");

  return 0;
}
</code></pre><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>gcc <span class="nt">-o</span> fork_exec fork_exec.c
<span class="gp">$</span><span class="w"> </span>./fork_exec
<span class="go">Before execl()
PID(17453): Parent global_cnt=2, local_cnt=3
PID(17454): global_cnt=3, local_cnt=4
PID(17453): global_cnt=2, local_cnt=3
Parent
</span></pre></table></code></div></div><ul><li>After execl() is not printed because “execl()” replace the process image “fork_exec” (including text, data, stack) with the previous image “fork”.</li><li>In this case, “vfork()” can be used for the same address space with parent’s so that redundant memory space does not created before being replaced with the previous image “fork”.</li></ul><h2 id="linux-task-model">Linux task model</h2></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/studysummary/'>StudySummary</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/task/" class="post-tag no-text-decoration" >task</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Linux Task Management - ADAS Study Group Tech Blog&url=https://adas-study-group.github.io/yocto_basics//posts/task-management/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Linux Task Management - ADAS Study Group Tech Blog&u=https://adas-study-group.github.io/yocto_basics//posts/task-management/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Linux Task Management - ADAS Study Group Tech Blog&url=https://adas-study-group.github.io/yocto_basics//posts/task-management/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/memory-management/">Linux Memory Management</a></li><li><a href="/posts/memory-node-zone-pageframe/">Memory Management(node,zone,pageframe)</a></li><li><a href="/posts/memory-buddy-slab/">Memory Management(buddy,slab)</a></li><li><a href="/posts/08YoctoProjectDev/">Study summary 기록 2020-09-28</a></li><li><a href="/posts/07BitbakeMetadata/">Study summary 기록 2020-09-15</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writing/">Writing</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/yocto/">Yocto</a> <a class="post-tag" href="/tags/blogging/">Blogging</a> <a class="post-tag" href="/tags/memory/">memory</a> <a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/programminglanguage/">ProgrammingLanguage</a> <a class="post-tag" href="/tags/meetup/">meetup</a> <a class="post-tag" href="/tags/gcp/">gcp</a> <a class="post-tag" href="/tags/wsl2gui/">WSL2GUI</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/linux-kernel/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Dec 5, 2020 <i class="unloaded">2020-12-05T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux Kernel Structure</h3><div class="text-muted small"><p> Linux kernel structure Operating System is a resource manager Resource Physical resource Abstract resource ...</p></div></div></a></div><div class="card"> <a href="/posts/memory-management/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Dec 7, 2020 <i class="unloaded">2020-12-07T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux Memory Management</h3><div class="text-muted small"><p> Memory management technic and virtual memory Virtual memory offers maximum sized Virtual Address Space to each Task. CPU Size ...</p></div></div></a></div><div class="card"> <a href="/posts/linux-file-system/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Dec 28, 2020 <i class="unloaded">2020-12-28T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux File System and Virtual File System</h3><div class="text-muted small"><p> File System Main Memory vs. Secondary Storage Memory Memory Management Device Volatility Accessing Unit main memory virtual ...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/memory-management/" class="btn btn-outline-primary"><p>Linux Memory Management</p></a> <a href="/posts/memory-buddy-slab/" class="btn btn-outline-primary"><p>Memory Management(buddy,slab)</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href=""></a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/writing/">Writing</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/yocto/">Yocto</a> <a class="post-tag" href="/tags/blogging/">Blogging</a> <a class="post-tag" href="/tags/memory/">memory</a> <a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/programminglanguage/">ProgrammingLanguage</a> <a class="post-tag" href="/tags/meetup/">meetup</a> <a class="post-tag" href="/tags/gcp/">gcp</a> <a class="post-tag" href="/tags/wsl2gui/">WSL2GUI</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', '', 'auto'); ga('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://adas-study-group.github.io/yocto_basics/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
